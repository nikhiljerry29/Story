chapter 4 of main branch